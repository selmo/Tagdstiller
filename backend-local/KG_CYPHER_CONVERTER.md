# Knowledge Graph JSON to Cypher Converter

Knowledge Graph JSON íŒŒì¼ì„ Neo4j/Memgraphìš© Cypher ì¿¼ë¦¬ë¡œ ë³€í™˜í•˜ëŠ” ìœ í‹¸ë¦¬í‹°ì…ë‹ˆë‹¤.

## ğŸ¯ ì£¼ìš” ê¸°ëŠ¥

- âœ… **ì™„ì „ ìë™ ë³€í™˜**: JSON â†’ Cypher ìŠ¤í¬ë¦½íŠ¸ ìë™ ìƒì„±
- âœ… **ë…¸ë“œ & ê´€ê³„ ìƒì„±**: ëª¨ë“  ì—”í‹°í‹°ì™€ ê´€ê³„ë¥¼ Cypher CREATE ë¬¸ìœ¼ë¡œ ë³€í™˜
- âœ… **í”„ë¡œí¼í‹° ë³´ì¡´**: ëª¨ë“  ì†ì„±ê°’ì„ ì •í™•íˆ ì´ìŠ¤ì¼€ì´í”„í•˜ì—¬ ë³€í™˜
- âœ… **ë©”íƒ€ë°ì´í„° í¬í•¨**: Knowledge Graph ë©”íƒ€ë°ì´í„°ë¥¼ ë³„ë„ ë…¸ë“œë¡œ ìƒì„±
- âœ… **ì¸ë±ìŠ¤ ìƒì„±**: ì„±ëŠ¥ ìµœì í™”ë¥¼ ìœ„í•œ ì¸ë±ìŠ¤ ìë™ ìƒì„± (ì„ íƒì )
- âœ… **DB ì´ˆê¸°í™”**: ê¸°ì¡´ ë°ì´í„° ì‚­ì œ ì˜µì…˜ (ì„ íƒì )

## ğŸ“¦ ì„¤ì¹˜

ì´ë¯¸ backend-local í”„ë¡œì íŠ¸ì— í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

```bash
# í”„ë¡œì íŠ¸ ë£¨íŠ¸ì—ì„œ
cd /Users/selmo/Projects/Tagdstiller/backend-local
```

## ğŸš€ ì‚¬ìš©ë²•

### 1. ì»¤ë§¨ë“œë¼ì¸ì—ì„œ ì‚¬ìš©

#### ê¸°ë³¸ ì‚¬ìš©
```bash
# JSON íŒŒì¼ë§Œ ì§€ì • (ì¶œë ¥ íŒŒì¼ì€ ìë™ ìƒì„±)
cd backend
python -m utils.kg_to_cypher /path/to/knowledge_graph.json
```

#### ì¶œë ¥ íŒŒì¼ ì§€ì •
```bash
python -m utils.kg_to_cypher input.json output.cypher
```

#### ì˜µì…˜ ì‚¬ìš©
```bash
# DB ì´ˆê¸°í™” í¬í•¨
python -m utils.kg_to_cypher input.json output.cypher --clear-db

# ì¸ë±ìŠ¤ ìƒì„± ì œì™¸
python -m utils.kg_to_cypher input.json output.cypher --no-indexes

# ëª¨ë“  ì˜µì…˜ ì¡°í•©
python -m utils.kg_to_cypher input.json output.cypher --clear-db --no-indexes
```

### 2. Bash ìŠ¤í¬ë¦½íŠ¸ ì‚¬ìš©

```bash
# ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‚¬ìš©í•œ ê°„ë‹¨í•œ ì‹¤í–‰
./scripts/kg_json_to_cypher.sh /path/to/knowledge_graph.json

# ì˜µì…˜ í¬í•¨
./scripts/kg_json_to_cypher.sh /path/to/knowledge_graph.json output.cypher --clear-db
```

### 3. Python ì½”ë“œì—ì„œ ì‚¬ìš©

```python
from utils.kg_to_cypher import convert_kg_json_to_cypher

# ê¸°ë³¸ ì‚¬ìš©
cypher = convert_kg_json_to_cypher(
    json_file="knowledge_graph.json",
    output_file="output.cypher"
)

# ì˜µì…˜ í¬í•¨
cypher = convert_kg_json_to_cypher(
    json_file="knowledge_graph.json",
    output_file="output.cypher",
    clear_db=True,        # DB ì´ˆê¸°í™”
    create_indexes=True   # ì¸ë±ìŠ¤ ìƒì„±
)

# í”„ë¡œê·¸ë˜ë° ë°©ì‹ìœ¼ë¡œ ì„¸ë°€í•œ ì œì–´
from utils.kg_to_cypher import KGToCypherConverter

converter = KGToCypherConverter()

# JSON íŒŒì¼ì—ì„œ ë³€í™˜
cypher = converter.convert_file(
    json_file_path="knowledge_graph.json",
    output_file_path="output.cypher",
    clear_db=False,
    create_indexes=True
)

# ë˜ëŠ” ì´ë¯¸ ë¡œë“œëœ ë°ì´í„°ì—ì„œ ë³€í™˜
import json
with open("knowledge_graph.json") as f:
    kg_data = json.load(f)

cypher = converter.convert(
    kg_data=kg_data,
    clear_db=False,
    create_indexes=True
)
```

## ğŸ“ ì‹¤ì œ ì‚¬ìš© ì˜ˆì‹œ

### ì˜ˆì‹œ 1: 0003.pdf ë¬¸ì„œì˜ KG ë³€í™˜

```bash
cd /Users/selmo/Projects/Tagdstiller/backend-local/backend

python -m utils.kg_to_cypher \
  /Users/selmo/TEMP/0003_chunked/knowledge_graph.json \
  /Users/selmo/TEMP/0003_chunked/knowledge_graph.cypher
```

**ê²°ê³¼**:
```
ğŸ“„ JSON íŒŒì¼: /Users/selmo/TEMP/0003_chunked/knowledge_graph.json
ğŸ“ ì¶œë ¥ íŒŒì¼: /Users/selmo/TEMP/0003_chunked/knowledge_graph.cypher
ğŸ—‘ï¸  DB ì´ˆê¸°í™”: False
ğŸ“Š ì¸ë±ìŠ¤ ìƒì„±: True

âœ… Cypher íŒŒì¼ ìƒì„± ì™„ë£Œ: /Users/selmo/TEMP/0003_chunked/knowledge_graph.cypher
ğŸ“Š ìƒì„±ëœ ì¿¼ë¦¬:
   - ë…¸ë“œ: 265ê°œ
   - ê´€ê³„: 187ê°œ
   - ì´ ë¼ì¸: 500ì¤„
```

### ì˜ˆì‹œ 2: ëª¨ë“  ì˜µì…˜ í¬í•¨

```bash
python -m utils.kg_to_cypher \
  /Users/selmo/TEMP/0003_chunked/knowledge_graph.json \
  /Users/selmo/TEMP/0003_chunked/full_import.cypher \
  --clear-db \
  --no-indexes
```

## ğŸ“Š ìƒì„±ëœ Cypher íŒŒì¼ êµ¬ì¡°

```cypher
// Knowledge Graph Import Script
// Generated by KGToCypherConverter

// Clear database (--clear-db ì˜µì…˜ ì‚¬ìš©ì‹œ)
MATCH (n) DETACH DELETE n;

// Create indexes for performance (ê¸°ë³¸ í¬í•¨)
CREATE INDEX IF NOT EXISTS FOR (n:Document) ON (n.id);
CREATE INDEX IF NOT EXISTS FOR (n:Document) ON (n.name);
CREATE INDEX IF NOT EXISTS FOR (n:Concept) ON (n.id);
CREATE INDEX IF NOT EXISTS FOR (n:Concept) ON (n.name);
...

// ==================== Create Nodes ====================

CREATE (chunk_001_n1:Document {id: 'chunk_001_n1', name: '0003'});
CREATE (chunk_001_n2:Tool {id: 'chunk_001_n2', name: 'Docling'});
CREATE (chunk_001_n3:Date {id: 'chunk_001_n3', name: '2025-11-03'});
...

// ==================== Create Relationships ====================

MATCH (chunk_001_n1 {id: 'chunk_001_n1'}), (chunk_001_n2 {id: 'chunk_001_n2'})
CREATE (chunk_001_n1)-[:USES {id: 'chunk_001_e1'}]->(chunk_001_n2);
...

// ==================== Add Metadata ====================

CREATE (meta:Metadata {source_document: '0003.pdf', domain: 'general'});

// ==================== Statistics ====================
// Total Nodes: 265
// Total Relationships: 187
```

## ğŸ—„ï¸ Memgraph/Neo4jì— ì„í¬íŠ¸

### ë°©ë²• 1: cypher-shell ì‚¬ìš© (Neo4j)

```bash
# Neo4jì— ì„í¬íŠ¸
cat knowledge_graph.cypher | cypher-shell -u neo4j -p password
```

### ë°©ë²• 2: Memgraph Lab ì‚¬ìš©

1. Memgraph Lab ì—´ê¸°: http://localhost:3000
2. Query íƒ­ ì„ íƒ
3. Cypher íŒŒì¼ ë‚´ìš© ë³µì‚¬ & ë¶™ì—¬ë„£ê¸°
4. Run ë²„íŠ¼ í´ë¦­

### ë°©ë²• 3: Pythonìœ¼ë¡œ ì§ì ‘ ì‹¤í–‰

```python
from neo4j import GraphDatabase

# Neo4j/Memgraph ì—°ê²°
driver = GraphDatabase.driver(
    "bolt://localhost:7687",
    auth=("neo4j", "password")
)

# Cypher íŒŒì¼ ì½ê¸°
with open("knowledge_graph.cypher", "r", encoding="utf-8") as f:
    cypher_script = f.read()

# ê° ì¿¼ë¦¬ ì‹¤í–‰
with driver.session() as session:
    for query in cypher_script.split(";"):
        query = query.strip()
        if query and not query.startswith("//"):
            session.run(query)

driver.close()
```

### ë°©ë²• 4: mgconsole ì‚¬ìš© (Memgraph)

```bash
# Memgraphì— ì„í¬íŠ¸
mgconsole < knowledge_graph.cypher
```

## âš™ï¸ ì˜µì…˜ ì„¤ëª…

### `--clear-db`
- **ì„¤ëª…**: ê¸°ì¡´ ê·¸ë˜í”„ ë°ì´í„°ë² ì´ìŠ¤ì˜ ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí•©ë‹ˆë‹¤
- **ì¿¼ë¦¬**: `MATCH (n) DETACH DELETE n;`
- **ì£¼ì˜**: í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œëŠ” ì‚¬ìš©í•˜ì§€ ë§ˆì„¸ìš”!
- **ìš©ë„**: í…ŒìŠ¤íŠ¸, ê°œë°œ í™˜ê²½ì—ì„œ ê¹¨ë—í•œ ìƒíƒœë¡œ ì‹œì‘í•  ë•Œ

### `--no-indexes`
- **ì„¤ëª…**: ì¸ë±ìŠ¤ ìƒì„± ì¿¼ë¦¬ë¥¼ ìƒì„±í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤
- **ê¸°ë³¸ê°’**: ì¸ë±ìŠ¤ ìƒì„± í¬í•¨
- **ìš©ë„**: ì´ë¯¸ ì¸ë±ìŠ¤ê°€ ìˆê±°ë‚˜, ìˆ˜ë™ìœ¼ë¡œ ì¸ë±ìŠ¤ë¥¼ ê´€ë¦¬í•˜ê³  ì‹¶ì„ ë•Œ

## ğŸ”§ ê³ ê¸‰ ì‚¬ìš©ë²•

### ì—¬ëŸ¬ KG íŒŒì¼ ì¼ê´„ ë³€í™˜

```bash
#!/bin/bash
# ë””ë ‰í† ë¦¬ ë‚´ ëª¨ë“  knowledge_graph.json íŒŒì¼ ë³€í™˜

for json_file in /Users/selmo/TEMP/*/knowledge_graph.json; do
    echo "Converting: $json_file"
    python -m utils.kg_to_cypher "$json_file"
done
```

### ë³€í™˜ í›„ ìë™ ì„í¬íŠ¸

```bash
#!/bin/bash
# ë³€í™˜ + Memgraph ìë™ ì„í¬íŠ¸

JSON_FILE="/Users/selmo/TEMP/0003_chunked/knowledge_graph.json"
CYPHER_FILE="${JSON_FILE%.json}.cypher"

# 1. ë³€í™˜
python -m utils.kg_to_cypher "$JSON_FILE" "$CYPHER_FILE" --clear-db

# 2. Memgraphì— ì„í¬íŠ¸
mgconsole < "$CYPHER_FILE"

echo "âœ… Import complete!"
```

### ë³€í™˜ ê²°ê³¼ ê²€ì¦

```python
from utils.kg_to_cypher import KGToCypherConverter
import json

# JSON íŒŒì¼ ë¡œë“œ
with open("knowledge_graph.json") as f:
    kg_data = json.load(f)

# ë³€í™˜
converter = KGToCypherConverter()
cypher = converter.convert(kg_data)

# í†µê³„ í™•ì¸
graph = kg_data.get("graph", kg_data)
nodes = graph.get("nodes", [])
edges = graph.get("edges", [])

print(f"ì›ë³¸ JSON:")
print(f"  - ë…¸ë“œ: {len(nodes)}ê°œ")
print(f"  - ê´€ê³„: {len(edges)}ê°œ")

print(f"\nìƒì„±ëœ Cypher:")
print(f"  - CREATE ë¬¸: {cypher.count('CREATE (')}ê°œ")
print(f"  - MATCH ë¬¸: {cypher.count('MATCH')}ê°œ")
```

## ğŸ› íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### ë¬¸ì œ 1: ë¬¸ì ì¸ì½”ë”© ì˜¤ë¥˜

**ì¦ìƒ**: `UnicodeDecodeError` ë°œìƒ

**í•´ê²°**:
```bash
# UTF-8ë¡œ ëª…ì‹œì  ì§€ì •
python -c "import sys; sys.stdin.reconfigure(encoding='utf-8')"
```

### ë¬¸ì œ 2: ë…¸ë“œ ID ì¤‘ë³µ

**ì¦ìƒ**: `Node with id 'xxx' already exists`

**í•´ê²°**: `--clear-db` ì˜µì…˜ ì‚¬ìš©
```bash
python -m utils.kg_to_cypher input.json output.cypher --clear-db
```

### ë¬¸ì œ 3: ëŒ€ìš©ëŸ‰ íŒŒì¼ ì²˜ë¦¬

**ì¦ìƒ**: ë©”ëª¨ë¦¬ ë¶€ì¡± ë˜ëŠ” ì²˜ë¦¬ ì‹œê°„ ë„ˆë¬´ ê¹€

**í•´ê²°**: ë°°ì¹˜ ì²˜ë¦¬ë¡œ ë¶„í•  ì„í¬íŠ¸
```python
# ë…¸ë“œë§Œ ë¨¼ì € ìƒì„±
converter = KGToCypherConverter()
nodes_cypher = converter._generate_node_queries(nodes)
with open("nodes.cypher", "w") as f:
    f.write("\n".join(nodes_cypher))

# ê´€ê³„ëŠ” ë‚˜ì¤‘ì—
edges_cypher = converter._generate_relationship_queries(edges)
with open("edges.cypher", "w") as f:
    f.write("\n".join(edges_cypher))
```

## ğŸ“š ì°¸ê³  ìë£Œ

- [Neo4j Cypher ë¬¸ë²•](https://neo4j.com/docs/cypher-manual/current/)
- [Memgraph Cypher ë¬¸ë²•](https://memgraph.com/docs/cypher-manual)
- [Knowledge Graph êµ¬ì¶• ê°€ì´ë“œ](README.md#ì²­í‚¹-ê¸°ë°˜-ì™„ì „-kg-ì¶”ì¶œ)

## ğŸ”„ ì—…ë°ì´íŠ¸ ë¡œê·¸

- **2025-11-03**: ì´ˆê¸° ë²„ì „ ë¦´ë¦¬ìŠ¤
  - JSON â†’ Cypher ë³€í™˜ ê¸°ëŠ¥
  - ì¸ë±ìŠ¤ ìë™ ìƒì„±
  - DB ì´ˆê¸°í™” ì˜µì…˜
  - ë©”íƒ€ë°ì´í„° ë…¸ë“œ ìƒì„±
